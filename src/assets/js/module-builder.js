const mainTable=document.querySelector("select#table"),controller=document.getElementById("module_controller"),modulePath=document.getElementById("module_path"),moduleName=document.getElementById("module_name"),bodyTableStep2=document.querySelector("#step2 .table-table tbody"),bodyTableStep3=document.querySelector("#step3 .table-table tbody"),moduleIcon=document.getElementById("module_icon"),buttonNext=document.querySelector(".btn-next");let lastSelectedTableValue=null,currentStep=1,baseTableColumns=[];function goToStepTwo(){if(mainTable.value&&controller.value&&modulePath.value&&moduleName.value&&moduleIcon.value){let e=mainTable.value;e!==lastSelectedTableValue&&loadTableColumns(e).then((async e=>{const t=await e.json();baseTableColumns=t.data;for(let[e,t]of baseTableColumns.entries())["id","uuid","created_at","updated_at"].includes(t)||bodyTableStep2.insertAdjacentHTML("beforeend",`<tr>\n                                <th>\n                                    <input type="text" class="form-control input-table input_label_form_table" value="${ucworld(t)}" name="table_label[]">\n                                </th>\n                                <th>\n                                    <input type="text" class="form-control input-table input_name_form_table" value="${t}" name="table_name[]">\n                                </th>\n                                <th>\n                                    <input type="text" class="form-control input-table input_join_form_table" name="table_join[]">\n                                </th>\n                                <th>\n                                    <input type="text" class="form-control input-table input_join_name_form_table" name="table_join_relation[]">\n                                </th>\n                                <th>\n                                    <button class="btn btn-danger btn-sm btn-delete-table-form w-100 justify-content-center"  type="button">Hapus</button>\n                                </th>\n                            </tr>`);appendRowStep3(),listener()})),lastSelectedTableValue=mainTable.value,baseTableColumns&&(goToTab("#step2"),currentStep=2)}else goToTab("#step1"),currentStep=1}function goToStepThree(){mainTable.value&&controller.value&&modulePath.value&&moduleName.value&&moduleIcon.value?mainTable.value!==lastSelectedTableValue?document.getElementById("step2-tab").click():(goToTab("#step3"),currentStep=3,setTimeout((()=>{buttonNext.innerHTML="SUBMIT",buttonNext.setAttribute("type","submit"),buttonNext.removeAttribute("onclick")}),50)):(goToTab("#step1"),currentStep=1)}function appendRowStep3(){for(let[e,t]of baseTableColumns.entries())["id","uuid","created_at","updated_at"].includes(t)||bodyTableStep3.insertAdjacentHTML("beforeend",` <tr>\n                    <th>\n                        <input type="text" class="form-control input-table input_label_form_table" value="${ucworld(t)}" name="form_label[]">\n                    </th>\n                    <th>\n                        <input type="text" class="form-control input-table input_name_form_table" value="${t}" name="form_name[]">\n                    </th>\n                    <th>\n                        <select id="" class="form-control input-table form-select" name="form_type[]">\n                            <option>text</option>\n                            <option>file</option>\n                            <option>foto</option>\n                            <option>email</option>\n                            <option>number</option>\n                            <option>password</option>\n                            <option>checkbox</option>\n                            <option>time</option>\n                            <option>date</option>\n                            <option>datetime</option>\n                            <option>googlemaps</option>\n                            <option>hidden</option>\n                            <option>money</option>\n                            <option>radio</option>\n                            <option>select</option>\n                            <option>selectsearch</option>\n                            <option>textarea</option>\n                            <option>wysiwyg</option>\n                        </select>\n                    </th>\n                    <th>\n                        <input type="text" class="form-control input-table" value="required|min:3|max:150" name="rules[]">\n                    </th>\n                    <th>\n                        <input type="text" class="form-control input-table" value="" name="rules_create[]">\n                    </th>\n                    <th>\n                        <input type="text" class="form-control input-table" value="" name="rules_update[]">\n                    </th>\n                    <th>\n                        <button class="btn btn-danger btn-sm w-100 btn-delete-table-form justify-content-center" type="button">Hapus</button>\n                    </th>\n                </tr>`);listenRulesValidation()}function goToTab(e){const t=document.querySelector(`#moduleGeneratorTabs a[href="${e}"]`);bootstrap.Tab.getInstance(t).show()}function addMoreForm(){bodyTableStep3.insertAdjacentHTML("beforeend",'<tr>\n        <th>\n            <input type="text" class="form-control input-table input_label_form_table" value="" name="form_label[]">\n        </th>\n        <th>\n            <input type="text" class="form-control input-table input_name_form_table" value="" name="form_name[]">\n        </th>\n        <th>\n            <select id="" class="form-control input-table form-select" name="form_type[]">\n                <option>text</option>\n                <option>file</option>\n                <option>foto</option>\n                <option>email</option>\n                <option>number</option>\n                <option>password</option>\n                <option>checkbox</option>\n                <option>time</option>\n                <option>date</option>\n                <option>datetime</option>\n                <option>googlemaps</option>\n                <option>hidden</option>\n                <option>money</option>\n                <option>radio</option>\n                <option>select</option>\n                <option>selectsearch</option>\n                <option>textarea</option>\n                <option>wysiwyg</option>\n            </select>\n        </th>\n        <th>\n            <input type="text" class="form-control input-table" value="required|min:3|max:150" name="rules[]">\n        </th>\n        <th>\n            <input type="text" class="form-control input-table" value="" name="rules_create[]">\n        </th>\n        <th>\n            <input type="text" class="form-control input-table" value="" name="rules_update[]">\n        </th>\n        <th>\n            <button class="btn btn-danger btn-sm w-100 btn-delete-table-form justify-content-center" type="button">Hapus</button>\n        </th>\n    </tr>'),setTimeout((()=>{listener(),listenRulesValidation()}),50)}function addMoreTable(){bodyTableStep2.insertAdjacentHTML("beforeend",'<tr>\n            <th>\n                <input type="text" class="form-control input-table input_label_form_table" name="table_label[]">\n            </th>\n            <th>\n                <input type="text" class="form-control input-table input_name_form_table" name="table_name[]">\n            </th>\n            <th>\n                <input type="text" class="form-control input-table input_join_form_table" name="table_join[]">\n            </th>\n            <th>\n                <input type="text" class="form-control input-table input_join_name_form_table" name="table_join_relation[]">\n            </th>\n            <th>\n                <button class="btn btn-danger btn-sm btn-delete-table-form w-100 justify-content-center" type="button">Hapus</button>\n            </th> \n        </tr>'),setTimeout((()=>{listener()}),50)}function ucworld(e){return e.replace("_"," ").replace(/^([a-z])|\s+([a-z])/g,(function(e){return e.toUpperCase()}))}function createSuggestion(e,t=!1){e.parentElement.querySelector("ul")?.remove();var n='<ul class="suggestion_module shadow-sm">';baseTableColumns.forEach((e=>{let o=e;t&&(o=ucworld(o)),n+="<li>"+o+"</li>"})),n+="</ul>",e.parentElement.insertAdjacentHTML("beforeend",n),suggestSelectedListener()}function createSuggestionJoinColumTable(e){var t=e.closest("tr").querySelector(".input_join_form_table").value;t&&loadTableColumns(t).then((async t=>{const n=await t.json();e.parentElement.querySelector("ul")?.remove();var o='<ul class="suggestion_module shadow-sm">';n.data.forEach((e=>{o+="<li>"+e+"</li>"})),o+="</ul>",e.parentElement.insertAdjacentHTML("beforeend",o),suggestSelectedListener()}))}function createSuggestionListTable(e){e.parentElement.querySelector("ul")?.remove();var t='<ul class="suggestion_module shadow-sm">';listTable.forEach((e=>{t+="<li>"+e.name+"</li>"})),t+="</ul>",e.parentElement.insertAdjacentHTML("beforeend",t),suggestSelectedListener()}function listener(){document.querySelectorAll(".btn-delete-table-form").forEach((e=>{e.addEventListener("click",(function(){e.closest("tr")?.remove()}))})),document.querySelectorAll(".input_label_form_table").forEach((e=>{e.addEventListener("click",(function(){createSuggestion(e,!0)}))})),document.querySelectorAll(".input_name_form_table").forEach((e=>{e.addEventListener("click",(function(){createSuggestion(e)}))})),document.querySelectorAll(".input_join_form_table").forEach((e=>{e.addEventListener("click",(function(){createSuggestionListTable(e)}))})),document.querySelectorAll(".input_join_name_form_table").forEach((e=>{e.addEventListener("click",(function(){createSuggestionJoinColumTable(e)}))})),document.querySelectorAll("#step2 input").forEach((e=>{e.addEventListener("blur",(function(){setTimeout((()=>{e.parentElement.querySelector(".suggestion_module")?.remove()}),100)}))}))}function suggestSelectedListener(){document.querySelectorAll(".suggestion_module li").forEach((e=>{e.addEventListener("click",(function(){e.closest("ul").parentElement.querySelector("input[type=text]").value=e.textContent,e.closest("ul")?.remove()}))}))}function next(){switch(currentStep){case 1:document.getElementById("step2-tab").click();break;case 2:document.getElementById("step3-tab").click();break;default:break}}function listenRulesValidation(){document.querySelectorAll('#step3 select[name="form_type[]"]').forEach((e=>{e.addEventListener("change",(function(){let t=["required"];switch(e.value){case"text":t.push("min:3","max:150");break;case"file":t.push("mimes:pdf,doc,docx");break;case"foto":t.push("image","mimes:jpeg,png,jpg,gif");break;case"email":t.push("email");break;case"number":t.push("numeric");break;case"password":t.push("min:8","max:50","regex:/^.*(?=.{3,})(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9]).*$/");break;case"checkbox":break;case"time":break;case"date":t.push("date");break;case"datetime":t.push("date");break;case"googlemaps":break;case"hidden":break;case"money":break;case"select":break;case"selectsearch":break;case"textarea":break;case"wysiwyg":break;default:break}e.closest("tr").querySelector('input[name="rules[]"]').value=t.join("|")}))}))}mainTable.addEventListener("change",(function(){const e=mainTable.value.split("_").join(" "),t=e?.toLowerCase().replace(/\b[a-z]/g,(function(e){return e.toUpperCase()})).replace(/ /g," ");controller.value=e?`Admin${t.replace(/ /g,"")}Controller`:"",modulePath.value=e?e?.toLowerCase().replace(/ /g,"-"):"",moduleName.value=t})),document.querySelectorAll("#moduleGeneratorTabs a.nav-link").forEach((e=>{e.addEventListener("click",(function(){buttonNext.innerHTML="NEXT",buttonNext.setAttribute("type","button"),buttonNext.setAttribute("onclick","next()")}))}));